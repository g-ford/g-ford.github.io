{"data":{"site":{"siteMetadata":{"title":"Stuff I write","author":"Geoff Ford"}},"markdownRemark":{"id":"89475187-5514-5d32-acd6-2d6b2fe30376","excerpt":"Probably because you are using it wrong. If you browse Stackoverflow for React questions, this is one of the most common questions that you…","html":"<p>Probably because you are using it wrong.</p>\n<p>If you browse Stackoverflow for React questions, this is one of the most common questions that you will find. Well, it is this or other versions of the same question. All this after Stackoverflow marks questions as duplicates.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleChange</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    value<span class=\"token punctuation\">:</span> newValue<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//Why is my state not updated?</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Why is your state not getting updated?</p>\n<p>Straight out of <a href=\"https://reactjs.org/docs/state-and-lifecycle.html#state-updates-may-be-asynchronous\">React docs</a>, <code class=\"language-text\">setState</code> may be asynchronous. What does that mean?</p>\n<p>Let’s find out.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>What is the output?</p>\n<p>First the second <code class=\"language-text\">console.log</code> fires and then the first one inside the <code class=\"language-text\">setTimeout</code> function. This happens because <code class=\"language-text\">setTimeout</code> is asynchronous and is moved to the browser thread. So the code that runs after <code class=\"language-text\">setTimeout</code> gets executed however small the timeout is.</p>\n<p>Same is the case with <code class=\"language-text\">setState</code> Because of it’s asynchronous state, the statement after is being called before the actual <code class=\"language-text\">setState</code> function.</p>\n<hr>\n<h3>How do we fix this?</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">handleChange</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span>\n      value<span class=\"token punctuation\">:</span> newValue<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">setState</code> actually comes with a callback version. All you have to do is provide the function to be run after the <code class=\"language-text\">setState</code> is executed. Here, you can give whatever action you wanted to perform once the setState is done.</p>\n<p>Since you might already have the result you are going to <code class=\"language-text\">setState</code> with, it might be better to utilise that result for regular operations rather than using the callback.</p>\n<p>PS: You could also just use <code class=\"language-text\">console.log(this.state.value)</code> in <code class=\"language-text\">render()</code> function or <code class=\"language-text\">componentDidUpdate()</code> but I’m guessing you already knew that.</p>\n<h3>Why is it asynchronous?</h3>\n<p>Now that you know how to fix it, you can leave.</p>\n<p>Or you can stay and figure out why is it made asynchronous. <em>Doesn’t it make React slower?</em></p>\n<p>From the docs:</p>\n<blockquote>\n<p>React may batch multiple <code class=\"language-text\">setState()</code> calls into a single update for performance.</p>\n</blockquote>\n<blockquote>\n<p>Because <code class=\"language-text\">this.props</code> and <code class=\"language-text\">this.state</code> may be updated asynchronously, you should not rely on their values for calculating the next state.</p>\n</blockquote>\n<p>Yes, that is just it. React it doing this for performance. You might not feel the need for it in a small application. But in a larger application where a lot of state updates may be taking place simultaneously, batching state updates comes as a boon.</p>\n<p>The <code class=\"language-text\">setState</code> comes with several other neat tricks as well, with <code class=\"language-text\">prevState</code> which you should definitely check out if you are new to React or may be just haven’t heard of it.</p>","fields":{"readingTime":{"text":"3 min read"}},"frontmatter":{"title":"dotnet in a Serverless world","date":"March 08, 2019"}}},"pageContext":{"slug":"/hello-world/","previous":null,"next":null}}