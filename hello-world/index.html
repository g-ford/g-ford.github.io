<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.7c8746e6e6f8f0b3004d.css">@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:200;src:local("Oswald Extra Light "),local("Oswald-Extra Light"),url(/static/oswald-latin-200-7de4e8c7241042bac22064babb6649a6.woff2) format("woff2"),url(/static/oswald-latin-200-74b035507786c9fa80f85f11d92a502c.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:300;src:local("Oswald Light "),local("Oswald-Light"),url(/static/oswald-latin-300-dc15f3b07cb711e818ecb48de992992c.woff2) format("woff2"),url(/static/oswald-latin-300-d2c191b2e46f060bf90b34e6b3f73d83.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:400;src:local("Oswald Regular "),local("Oswald-Regular"),url(/static/oswald-latin-400-f15aa285863274b4f6ed578caa76565e.woff2) format("woff2"),url(/static/oswald-latin-400-ca70f49a133f08485bd05d5cb28ef8b7.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:500;src:local("Oswald Medium "),local("Oswald-Medium"),url(/static/oswald-latin-500-541a863959122f29c9961095cdcbb5c2.woff2) format("woff2"),url(/static/oswald-latin-500-deebf8fc5d31111f3144d0c6373143cc.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:600;src:local("Oswald SemiBold "),local("Oswald-SemiBold"),url(/static/oswald-latin-600-b81a3735849bb304ae25ae10c748d5ab.woff2) format("woff2"),url(/static/oswald-latin-600-452513e2767e99884b1c084dad03126b.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:700;src:local("Oswald Bold "),local("Oswald-Bold"),url(/static/oswald-latin-700-3e941c0d10bcb614ac1442884055d2bf.woff2) format("woff2"),url(/static/oswald-latin-700-7eb521f12cd966b030825fa662677353.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.0.76"/><style data-styled="fbJHg gxsCvX SzhqG farUpD dqlJwV eIJXms hbVWcy loUmBT nTaEa eUgifa coHVso idmYOI lczczh" data-styled-version="4.1.3">
/* sc-component-id: styled-link__StyledLink-evpd30-0 */
.gxsCvX{-webkit-text-decoration:none;text-decoration:none;color:rgba(0,0,0,0.8);}
/* sc-component-id: header__Container-q6n5p1-0 */
.fbJHg{box-shadow:0 4px 12px 0 rgba(0,0,0,0.05);height:6rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}
/* sc-component-id: header__Title-q6n5p1-1 */
.SzhqG{font-size:1.6rem;font-weight:800;-webkit-letter-spacing:0.1rem;-moz-letter-spacing:0.1rem;-ms-letter-spacing:0.1rem;letter-spacing:0.1rem;text-transform:uppercase;margin:0;} @media (max-width:36em){.SzhqG{text-align:center;}}
/* sc-component-id: sc-global-856903544 */
@font-face{font-family:system;font-style:normal;font-weight:300;src:local('.SFNSText-Light'),local('.HelveticaNeueDeskInterface-Light'), local('.LucidaGrandeUI'),local('Ubuntu Light'),local('Segoe UI Light'), local('Roboto-Light'),local('DroidSans'),local('Tahoma');} :root{font-size:10px;} body{font-family:'system';margin:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);min-height:100vh;position:relative;font-size:1.6rem;} h1,h2,h3,h4,h5,h6{font-family:'Oswald',sans-serif;} h2{font-size:2.5rem;} h3{font-size:2.4rem;} h4{font-size:1.6rem;} code{font-family:Menlo,Monaco,"Courier New",Courier,monospace;word-break:break-word;} pre code{word-break:normal;} :not(pre) > code[class*="language-"],pre[class*="language-text"]{background-color:transparent;color:inherit;font-size:medium;}
/* sc-component-id: layout__Footer-sc-13bvcqm-0 */
.lczczh{display:block;height:6rem;}
/* sc-component-id: layout__Content-sc-13bvcqm-1 */
.farUpD{width:60%;max-width:728px;margin:0 auto;} @media (max-width:48em){.farUpD{width:80%;}}
/* sc-component-id: post-styles__Container-e9edps-0 */
.dqlJwV{margin-top:8rem;} @media (max-width:36em){.dqlJwV{margin-top:4rem;}} .dqlJwV p{line-height:1.5;} .dqlJwV blockquote{margin-left:0.25rem;font-size:1.6rem;color:inherit;font-style:italic;border-left:0.2rem solid rgb(0,0,0);padding-left:1rem;margin:1rem 0;} .dqlJwV pre{margin-bottom:2rem;} .dqlJwV h3{line-height:1.13;} .dqlJwV h2,.dqlJwV h3,.dqlJwV h4,.dqlJwV h5,.dqlJwV h6{margin:2rem 0 2rem;} .dqlJwV hr{border:0;border-top:0.1rem solid #ccc;display:block;height:1rem;padding:0;}
/* sc-component-id: post-styles__Header-e9edps-1 */
@media (max-width:48em){.eIJXms{text-align:center;}}
/* sc-component-id: post-styles__Title-e9edps-2 */
.hbVWcy{margin-bottom:1rem;font-size:3rem;}
/* sc-component-id: post-styles__LinkList-e9edps-3 */
.idmYOI{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0px;}
/* sc-component-id: share__Container-awx3z1-0 */
.eUgifa{margin:1rem 0 5rem;} .eUgifa .social-icon{display:inline-block;margin:0 0.5rem;cursor:pointer;}
/* sc-component-id: sc-bdVaJa */
.coHVso{font-size:1.4rem;color:rgb(0,0,0);}
/* sc-component-id: sc-bwzfXH */
.loUmBT{color:rgba(0,0,0,0.8);}
/* sc-component-id: sc-htpNat */
.nTaEa{margin:5rem 0;}</style><title data-react-helmet="true">Lets look at some code | Stuff I write</title><meta data-react-helmet="true" name="description" content="Probably because you are using it wrong. If you browse Stackoverflow for React questions, this is one of the most common questions that you…"/><meta data-react-helmet="true" property="og:title" content="Lets look at some code"/><meta data-react-helmet="true" property="og:description" content="Probably because you are using it wrong. If you browse Stackoverflow for React questions, this is one of the most common questions that you…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Geoff Ford"/><meta data-react-helmet="true" name="twitter:title" content="Lets look at some code"/><meta data-react-helmet="true" name="twitter:description" content="Probably because you are using it wrong. If you browse Stackoverflow for React questions, this is one of the most common questions that you…"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/webpack-runtime-e94332c60b7e30a09aaa.js"/><link as="script" rel="preload" href="/app-ba9b705b9d21bd0851e0.js"/><link as="script" rel="preload" href="/0-24f2663418ef9b1ba734.js"/><link as="script" rel="preload" href="/8-18ce81d5f445de81550e.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-a9b8ed674718ca3e44b7.js"/><link as="fetch" rel="preload" href="/static/d/350/path---hello-world-8-bc-b62-f0A3V8o3NL0nf6YnlYBOaWnVtU.json" crossOrigin="use-credentials"/></head><body><noscript>Sorry! This site requires JavaScript to be enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><nav class="header__Container-q6n5p1-0 fbJHg"><a class="styled-link__StyledLink-evpd30-0 gxsCvX" href="/"><h1 class="header__Title-q6n5p1-1 SzhqG">Stuff I write</h1></a></nav><div class="layout__Content-sc-13bvcqm-1 farUpD"><article class="post-styles__Container-e9edps-0 dqlJwV"><header class="post-styles__Header-e9edps-1 eIJXms"><h1 class="post-styles__Title-e9edps-2 hbVWcy">Lets look at some code</h1><sub class="sc-bwzfXH loUmBT"><span>Posted on <!-- -->April 14, 2018</span><span>  -  </span><span>3 min read</span></sub></header><div class="sc-htpNat nTaEa"><p>Probably because you are using it wrong.</p>
<p>If you browse Stackoverflow for React questions, this is one of the most common questions that you will find. Well, it is this or other versions of the same question. All this after Stackoverflow marks questions as duplicates.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> newValue<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Why is my state not updated?</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Why is your state not getting updated?</p>
<p>Straight out of <a href="https://reactjs.org/docs/state-and-lifecycle.html#state-updates-may-be-asynchronous">React docs</a>, <code class="language-text">setState</code> may be asynchronous. What does that mean?</p>
<p>Let’s find out.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>What is the output?</p>
<p>First the second <code class="language-text">console.log</code> fires and then the first one inside the <code class="language-text">setTimeout</code> function. This happens because <code class="language-text">setTimeout</code> is asynchronous and is moved to the browser thread. So the code that runs after <code class="language-text">setTimeout</code> gets executed however small the timeout is.</p>
<p>Same is the case with <code class="language-text">setState</code> Because of it’s asynchronous state, the statement after is being called before the actual <code class="language-text">setState</code> function.</p>
<hr>
<h3>How do we fix this?</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> newValue<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">setState</code> actually comes with a callback version. All you have to do is provide the function to be run after the <code class="language-text">setState</code> is executed. Here, you can give whatever action you wanted to perform once the setState is done.</p>
<p>Since you might already have the result you are going to <code class="language-text">setState</code> with, it might be better to utilise that result for regular operations rather than using the callback.</p>
<p>PS: You could also just use <code class="language-text">console.log(this.state.value)</code> in <code class="language-text">render()</code> function or <code class="language-text">componentDidUpdate()</code> but I’m guessing you already knew that.</p>
<h3>Why is it asynchronous?</h3>
<p>Now that you know how to fix it, you can leave.</p>
<p>Or you can stay and figure out why is it made asynchronous. <em>Doesn’t it make React slower?</em></p>
<p>From the docs:</p>
<blockquote>
<p>React may batch multiple <code class="language-text">setState()</code> calls into a single update for performance.</p>
</blockquote>
<blockquote>
<p>Because <code class="language-text">this.props</code> and <code class="language-text">this.state</code> may be updated asynchronously, you should not rely on their values for calculating the next state.</p>
</blockquote>
<p>Yes, that is just it. React it doing this for performance. You might not feel the need for it in a small application. But in a larger application where a lot of state updates may be taking place simultaneously, batching state updates comes as a boon.</p>
<p>The <code class="language-text">setState</code> comes with several other neat tricks as well, with <code class="language-text">prevState</code> which you should definitely check out if you are new to React or may be just haven’t heard of it.</p></div><div class="share__Container-awx3z1-0 eUgifa"><p class="sc-bdVaJa coHVso">Share if you liked it:</p></div><ul class="post-styles__LinkList-e9edps-3 idmYOI"><li><a rel="prev" href="/here-another/">← <!-- -->Images and Embeds</a></li><li><a rel="next" href="/text-headings/">Just text and links<!-- --> →</a></li></ul></article></div><footer class="layout__Footer-sc-13bvcqm-0 lczczh"></footer></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"hello-world-8bc","path":"/hello-world/"};window.dataPath="350/path---hello-world-8-bc-b62-f0A3V8o3NL0nf6YnlYBOaWnVtU";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.7c8746e6e6f8f0b3004d.css","/app-ba9b705b9d21bd0851e0.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-c890e0d148bff122bfbe.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-a9b8ed674718ca3e44b7.js"],"component---src-pages-404-js":["/component---src-pages-404-js-88dedceaf5b40be2c049.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d100ad1fc083bf6c5c7f.js"],"pages-manifest":["/pages-manifest-7da965cf151f0dbf2c01.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-a9b8ed674718ca3e44b7.js" async=""></script><script src="/8-18ce81d5f445de81550e.js" async=""></script><script src="/0-24f2663418ef9b1ba734.js" async=""></script><script src="/app-ba9b705b9d21bd0851e0.js" async=""></script><script src="/webpack-runtime-e94332c60b7e30a09aaa.js" async=""></script></body></html>